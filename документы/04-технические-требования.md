# Технические требования для интеграции ПКТ

## Архитектурные требования

### Общие принципы
- **Модульность**: Система должна легко расширяться новыми типами мероприятий
- **Масштабируемость**: Поддержка роста количества участников и мероприятий
- **Надежность**: Отказоустойчивость и резервное копирование данных
- **Безопасность**: Защита персональных данных и предотвращение подделок

### Техническая архитектура
```
┌─────────────────┐    ┌──────────────────┐    ┌─────────────────┐
│   Frontend      │    │    Backend       │    │   Database      │
│   (Next.js)     │◄──►│   (FastAPI)      │◄──►│  (PostgreSQL)   │
│                 │    │                  │    │                 │
│ - Admin Panel   │    │ - Badge API      │    │ - Users         │
│ - Public Views  │    │ - Auth Service   │    │ - Badges        │
│ - Badge Gallery │    │ - Verification   │    │ - Events        │
└─────────────────┘    └──────────────────┘    └─────────────────┘
```

## Функциональные требования

### 1. Управление организацией
#### Организационный профиль ПКТ
- **Название**: Петроградский клуб туристов
- **Логотип**: Загрузка и отображение логотипа организации
- **Описание**: Краткая информация о клубе и его деятельности
- **Контакты**: Email, телефон, сайт, социальные сети
- **Статус верификации**: Подтвержденная организация

#### Права администрирования
- **Суперадминистратор**: Полные права управления
- **Администраторы мероприятий**: Права на конкретные события
- **Модераторы**: Права на выдачу определенных категорий бейджей

### 2. Система бейджей

#### Создание и управление бейджами
```typescript
interface Badge {
  id: string;                    // Уникальный идентификатор
  name: string;                  // Название бейджа
  description: string;           // Описание достижения
  category: BadgeCategory;       // Категория (участие, достижение, лидерство, экспертиза)
  event_type: string;           // Тип мероприятия
  criteria: string;             // Критерии получения
  image_url: string;            // URL изображения бейджа
  issuer: Organization;         // Организация-эмитент
  created_at: DateTime;         // Дата создания
  is_active: boolean;           // Активность бейджа
}
```

#### Выдача бейджей
```typescript
interface BadgeIssuance {
  id: string;
  badge_id: string;
  recipient_email: string;
  recipient_name: string;
  issued_by: string;            // ID администратора
  issued_at: DateTime;
  event_date: DateTime;         // Дата мероприятия
  verification_url: string;     // URL для верификации
  metadata: {                   // Дополнительные данные
    event_name: string;
    category?: string;
    place?: number;
    team_name?: string;
  };
}
```

### 3. Пользовательские интерфейсы

#### Административная панель
**URL**: `/admin/pkt`

**Основные функции**:
- Дашборд с ключевыми метриками
- Управление мероприятиями и бейджами
- Массовая выдача бейджей
- Просмотр и экспорт отчетов
- Управление пользователями

**Экраны**:
1. **Дашборд**
   - Общая статистика выданных бейджей
   - Активные мероприятия
   - Недавние выдачи
   
2. **Мероприятия**
   - Календарь мероприятий ПКТ
   - Создание/редактирование событий
   - Привязка бейджей к мероприятиям
   
3. **Выдача бейджей**
   - Поиск участников
   - Массовая выдача по спискам
   - Индивидуальная выдача
   
4. **Отчеты**
   - Статистика по мероприятиям
   - Активность участников
   - Экспорт данных

#### Публичные страницы
**URL**: `/org/pkt`

**Основные разделы**:
1. **Профиль организации** (`/org/pkt`)
   - Информация о ПКТ
   - Статистика выданных бейджей
   - Календарь мероприятий
   
2. **Каталог бейджей** (`/org/pkt/badges`)
   - Все доступные бейджи ПКТ
   - Фильтрация по категориям
   - Критерии получения
   
3. **Галерея достижений** (`/org/pkt/achievements`)
   - Последние выданные бейджи
   - Топ участников
   - Истории успеха

#### Профили участников
**URL**: `/profile/{user_id}`

**Функции**:
- Коллекция полученных бейджей
- Статистика участия в мероприятиях ПКТ
- Прогресс по различным категориям
- Возможность поделиться достижениями

### 4. API для интеграций

#### Основные эндпоинты

**Аутентификация**:
```http
POST /api/auth/login
POST /api/auth/refresh
POST /api/auth/logout
```

**Управление бейджами**:
```http
GET    /api/badges                    # Список бейджей
POST   /api/badges                    # Создание бейджа
GET    /api/badges/{badge_id}         # Детали бейджа
PUT    /api/badges/{badge_id}         # Обновление бейджа
DELETE /api/badges/{badge_id}         # Удаление бейджа
```

**Выдача бейджей**:
```http
POST   /api/badges/issue              # Выдача бейджа
POST   /api/badges/bulk-issue         # Массовая выдача
GET    /api/badges/issued             # Список выданных бейджей
```

**Верификация**:
```http
GET    /api/verify/{verification_id}  # Проверка подлинности
```

### 5. Система верификации

#### Open Badges совместимость
```json
{
  "@context": "https://w3id.org/openbadges/v2",
  "type": "Assertion",
  "id": "https://symbolme.ru/api/verify/{assertion_id}",
  "recipient": {
    "type": "email",
    "hashed": true,
    "salt": "...",
    "identity": "sha256$..."
  },
  "badge": {
    "type": "BadgeClass",
    "id": "https://symbolme.ru/api/badges/{badge_id}",
    "name": "Участник ПКТ фест",
    "description": "Бейдж за участие в ежегодном фестивале ПКТ",
    "image": "https://symbolme.ru/images/badges/pkt-fest-participant.png",
    "criteria": {
      "narrative": "Участие в мероприятиях ПКТ фест"
    },
    "issuer": {
      "type": "Issuer",
      "id": "https://symbolme.ru/api/issuers/pkt",
      "name": "Петроградский клуб туристов",
      "url": "https://pkt.ru"
    }
  },
  "issuedOn": "2025-08-15T10:00:00Z",
  "verification": {
    "type": "hosted"
  }
}
```

## Требования безопасности

### Аутентификация и авторизация
- **JWT токены** с коротким временем жизни (15 минут)
- **Refresh токены** для продления сессии
- **Многофакторная аутентификация** для администраторов
- **Ролевая модель доступа** (RBAC)

### Защита данных
- **Шифрование** персональных данных в базе
- **Хеширование** email адресов в бейджах
- **HTTPS** для всех соединений
- **Rate limiting** для API эндпоинтов

### Аудит и логирование
- **Логирование всех операций** с бейджами
- **Аудит изменений** в административной панели
- **Мониторинг подозрительной активности**
- **Резервное копирование** каждые 24 часа

## Требования к производительности

### Время отклика
- **Страницы пользователей**: < 2 секунд
- **API запросы**: < 500 мс
- **Массовая выдача бейджей**: < 5 секунд на 100 бейджей
- **Верификация бейджа**: < 1 секунды

### Масштабируемость
- **Одновременные пользователи**: 500+
- **Бейджи в системе**: 10,000+
- **Выдача в час**: 1,000+
- **Хранение изображений**: 10 ГБ+

### Доступность
- **Uptime**: 99.5%
- **Время восстановления**: < 4 часов
- **Резервное копирование**: Ежедневно
- **Мониторинг**: 24/7

## 🔧 Технические спецификации

### Frontend (Next.js)
```typescript
// Основные зависимости
{
  "next": "^14.0.0",
  "react": "^18.0.0",
  "typescript": "^5.0.0",
  "tailwindcss": "^3.0.0",
  "@headlessui/react": "^1.7.0",
  "framer-motion": "^10.0.0",
  "react-query": "^3.39.0",
  "axios": "^1.0.0"
}
```

### Backend (FastAPI)
```python
# requirements.txt
fastapi==0.104.1
uvicorn[standard]==0.24.0
sqlalchemy==2.0.23
alembic==1.12.1
psycopg2-binary==2.9.9
pydantic==2.5.0
python-jose[cryptography]==3.3.0
passlib[bcrypt]==1.7.4
python-multipart==0.0.6
pillow==10.1.0
```

### Database (PostgreSQL)
```sql
-- Основные таблицы
CREATE TABLE organizations (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(255) NOT NULL,
    slug VARCHAR(100) UNIQUE NOT NULL,
    description TEXT,
    logo_url VARCHAR(500),
    created_at TIMESTAMP DEFAULT NOW()
);

CREATE TABLE badges (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    organization_id UUID REFERENCES organizations(id),
    name VARCHAR(255) NOT NULL,
    description TEXT,
    category VARCHAR(50) NOT NULL,
    image_url VARCHAR(500),
    criteria TEXT,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT NOW()
);

CREATE TABLE badge_issuances (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    badge_id UUID REFERENCES badges(id),
    recipient_email VARCHAR(255) NOT NULL,
    recipient_name VARCHAR(255),
    issued_by UUID REFERENCES users(id),
    issued_at TIMESTAMP DEFAULT NOW(),
    event_date TIMESTAMP,
    verification_url VARCHAR(500),
    metadata JSONB
);
```

## 📋 Чек-лист готовности к запуску

### Инфраструктура
- [ ] Настроена продакшн среда
- [ ] Настроен домен и SSL сертификаты
- [ ] Настроен мониторинг и алертинг
- [ ] Настроено резервное копирование
- [ ] Проведено нагрузочное тестирование

### Функциональность
- [ ] Все API эндпоинты протестированы
- [ ] Административная панель полностью функциональна
- [ ] Система верификации работает корректно
- [ ] Публичные страницы отображаются правильно
- [ ] Email уведомления настроены

### Безопасность
- [ ] Проведен security audit
- [ ] Настроены права доступа
- [ ] Включено логирование всех операций
- [ ] Настроена защита от DDOS
- [ ] Проверена GDPR совместимость

### Контент
- [ ] Созданы все приоритетные бейджи
- [ ] Загружены изображения бейджей
- [ ] Настроен профиль организации ПКТ
- [ ] Подготовлены обучающие материалы
- [ ] Созданы тестовые аккаунты

---

*Технические требования разработаны в соответствии с архитектурой платформы Символ и спецификой ПКТ*
